<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="/bower_components/paper-input/paper-textarea.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/gold-email-input/gold-email-input.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="/bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="/bower_components/polymerfire/firebase-app-script.html">
<link rel="import" href="/bower_components/iron-form/iron-form.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/bower_components/iron-icons/device-icons.html">

<link rel="import" href="/styles/input-styles.html">
<link rel="import" href="/styles/layout-styles.html">
<link rel="import" href="/styles/button-styles.html">

<dom-module id="docinfo-view">
    <template>
        <style include="button-styles layout-styles input-styles">
            :host {
                display: block;
            }

            .green {
                background-color: var(--app-green-color);
                color: #fff !important;
            }

            .blue {
                background-color: var(--app-accent-color);
                color: #fff !important;
            }

            .green-text {
                color: var(--app-green-color);
            }

            .blue-text {
                color: var(--app-accent-color);
            }

            .grey {
                background-color: #fafafb;
                border-top: 1px solid #e7e7e8;
                border-bottom: 1px solid #e7e7e8;
            }

            a {
                text-decoration: none;
            }

            h1 {
                letter-spacing: 0.02em;
            }

            paper-button, a {
                transition: all 0.3s cubic-bezier(.25, .8, .25, 1);
                box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);
            }

            .main-frame {
                max-width: 1200px;
                font-weight: lighter;
                padding: 0;
                color: #252526;
                margin: 2em auto;
            }

            .grid section {
                padding: 4.5em 5%;
                margin: 0 !important;
                position: relative;
            }

            section > p {
                font-size: 1.15em;
                line-height: 1.65em;
            }

            section > h1 {
                font-size: 1.6em;
                margin-top: 0;
            }

            .presentation-img {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                margin: auto;
            }

            #patient-image {
                max-width: 150px;
            }

            #comp-img {
                margin-left: 0;
                margin-bottom: 0;
                max-width: 480px;
                max-height: 480px;
            }

            .img-section {
                text-align: center;
            }

            /*** ABOUT ***/

            #profile-images-section {
                margin-left: 5em;
                max-width: 160px;
                padding-left: 5em;
                padding-right: 5em;
                border-left: 1px solid #e2e2e3;

            }

            .profile-image {
                position: static;
                max-width: 170px;
                max-height: 170px;
            }

            #about-section {
                margin-bottom: 0;
            }

            /***** WHAT WE OFFER HEADER *******/

            #what-we-offer {
                text-align: center;
                margin: 2em auto 4em auto;
            }

            #what-we-offer h1 {
                color: var(--app-accent-color);
                display: inline-block;
                font-size: 2.2em;
                margin: 1em auto 0;
                padding: 0 1.3em 0.2em 1.3em;
                position: relative;
            }

            #arrow-image {
                max-height: 40px;
                display: inline-block;
                position: absolute;
                right: 0;
                bottom: 0;
                left: auto;
                top: auto;
            }

            /***** OFFICE PRESENTATION ********/

            #office-presence-section a {
                font-weight: bold;
                background-color: var(--app-green-color);
                color: #fff;
                padding: 0.5em 1em;
                border-radius: 1em;
            }

            /*** QUESTION FORM ***/

            #question-container {
                background-color: #fbfbfc;
                padding: 3em;
            }

            #question-container h2 {
                font-size: 1.5em;
                letter-spacing: 0.02em;
                margin-top: 0.5em;
            }

            form {
                max-width: 500px;
                margin: 0 auto;
            }

            /** SQUARES SECTION **/

            #first-square-section {
                margin-bottom: 0;
            }

            #last-presentation-section {
                margin-top: 0;
            }

            #no-contract-section {
                box-shadow: 0 10px 28px rgba(0, 0, 0, 0.25), 0 18px 10px rgba(0, 0, 0, 0.22);
            }

            #office-presence-main-section {
                margin-top: 0;
            }

            /*** FEATURES ***/

            .features-section {
                text-align: center;
                padding-top: 2em !important;
                padding-bottom: 2em;
            !important;
            }

            .features-section > div {
                margin: 0.7em 0;
            }

            .features-section p {
                display: inline-block;
                text-align: left;
            }

            #all-features-description {
                margin: 3em auto;
                text-align: center;
                border-bottom: 1px solid #e2e2e3;
            }

            /******************************/

            @media (max-width: 980px) {
                #comp-img {
                    max-width: 350px;
                    max-height: 350px;
                }
            }

            @media (max-width: 716px) {

                .grid section {
                    padding: 7% 5%;
                }

                .presentation-img {
                    position: static;
                    max-width: 150px;
                    max-height: 150px;
                }

                #profile-images-section {
                    margin: 0;
                    padding-left: 0;
                    padding-right: 0;
                    border: none;
                    text-align: center;
                    max-width: 100%;
                }

                #office-registration section {
                    margin-top: 0;
                }

                #office-registration section:first-child {
                    border-right: none;
                    padding-bottom: 4em;
                    border-bottom: 2px solid #374C80;
                }

                #office-registration section:nth-child(2) {
                    padding-top: 4em;
                }

                #office-registration h1 {
                    margin-bottom: 0;
                    font-size: 1.8em;
                }

                #all-features-description {
                    text-align: left;
                }
            }

            @media (min-width: 767px) {

                paper-button:hover {
                    transform: scale(1.1);
                    box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);
                }

                a:hover {
                    box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);
                }
            }


        </style>

        <iron-media-query query="max-width:716px" query-matches="{{smallScreen}}"></iron-media-query>

        <section id="about-section" class="main-frame grid">
            <section>
                <h1>Kdo jsme a co děláme</h1>
                <p>
                    Jsme dva studenti kybernetiky a víme, že největším problémem moderních technologií je jejich
                    složitost. Často pak nejsou využívány tam, kde to má největší smysl. <br><br>

                    Naším cílem je, aby se online interakce ve zdravotnictví stala samozřejmostí. Chceme, aby naše práce
                    a úsilí mělo smysl, a proto upřednostňujeme úspěch našeho produktu před finančním ziskem.<br><br>

                    Uvědomujeme si, že naše služby jsou přínosem především pro pacienty. Je tak nelogické, aby
                    lékaři podepisovali nesmyslné smlouvy a platili za pohodlí pacientů.
                    Proto za náš systém nebudete muset nikdy platit.
                </p>
            </section>
            <section id="profile-images-section" class="">
                <img src="../images/docinfo/jan.jpg" class="profile-image">
                <img src="../images/docinfo/robert.jpg" class="profile-image">
            </section>
        </section>

        <section id="what-we-offer" class="main-frame">
            <h1>Co nabízíme?<img src="../images/docinfo/arrow.png" id="arrow-image"></h1>
        </section>

        <section class="main-frame grid grey" id="office-presence-main-section">
            <section class="img-section" hidden="[[smallScreen]]">
                <img id="comp-img" class="presentation-img" src="../images/docinfo/computer.png">
            </section>
            <section id="office-presence-section">
                <h1>Kompletní prezentace ordinace</h1>
                <p>Na Docta.cz můžete prezentovat všechny důležité informace o Vaší ordinaci zcela zdarma a
                    napořád.
                    <br>
                    <br>
                    <a href="/d/strakova_plzen">Zobrazit ukázkový profil</a>
                </p>
            </section>
        </section>

        <section class="main-frame grid">
            <section>
                <h1>Přenechte objednání pacientům</h1>
                <p>Nemarněte čas vyřizováním telefonátů a nechte pacienty, ať se objednají sami.
                    V ordinaci se tak můžete nerušeně věnovat své práci.
                    Podle Vašich objednávacích hodin Vám vytvoříme kalendář na míru.
                </p>
            </section>
            <section class="img-section">
                <img id="patient-image" src="../images/docinfo/patient.png">
            </section>
        </section>

        <section class="main-frame grid" id="first-square-section">
            <section class="blue">
                <h1>Máte kontrolu nad pacienty</h1>
                <p>Nemusíte mít strach, že se k Vám bude objednávat kdokoliv. Můžete si vybrat, kteří pacienti se u
                    Vás mohou objednat. U každého pacienta uvidíte údaje potřebné k jeho jednoznačné identifikaci.</p>
            </section>
            <section class="grey">
                <h1>Vše na jednom místě</h1>
                <p>V rozhraní Vaší ordinace máte vše, co potřebujete. Elektronický kalendář, seznam objednaných pacientů, nastavení ordinace, dovolené
                    a další.
                </p>
            </section>
        </section>

        <section class="main-frame grid" id="last-presentation-section">
            <section class="grey">
                <h1>Objednávejte jednoduše</h1>
                <p>Elektronický kalendář přehledně reprezentuje Vaše objednané pacienty. Můžete tak snadno objednávat nové pacienty nebo rušit
                    schůzky.</p>
            </section>
            <section class="green" id="no-contract-section">
                <h1>Bez smlouvy a závazků</h1>
                <p>Vše můžete začít používat ihned a bez placení.
                    Nemusíte se nám nijak zavazovat, je tak zcela
                    na Vás, jak budete našich služeb využívat.
                </p>
            </section>
        </section>

        <section id="all-features-description" class="main-frame grid">
            <section>
                <h1>Kompletní přehled služeb</h1>
                <p>Všechny služby jsou k dispozici bez poplatků a další budou přibývat.
                    <br>Přáli byste si nějakou další službu? Dejte nám vědět a přispějte tak ke zlepšení systému.
                </p>
            </section>
        </section>

        <section id="all-features-container" class="main-frame grid">
            <section class="features-section green-text">
                <h1>Prezentace ordinace</h1>
                <p>
                    &#8226; &nbsp; Kontaktní informace<br>
                    &#8226; &nbsp; Seznam smluvních pojišťoven<br>
                    &#8226; &nbsp; Ceník poskytovaných služeb<br>
                    &#8226; &nbsp; Upozornění na dovolenou
                </p>
            </section>
            <section class="features-section blue-text">

                <h1>Online objednání</h1>
                <p>
                    &#8226; &nbsp; Online objednávání pacientů<br>
                    &#8226; &nbsp; Kontrola nad objednanými pacienty<br>
                    &#8226; &nbsp; Elektronický kalendář
                </p>
            </section>
        </section>

        <div>
                <a href="[[computeUrl(signedIn)]]">
                    <paper-button raised>[[computeButtonText(signedIn)]]</paper-button>
                </a>
        </div>

        <div id="question-container" hidden="[[messageSent]]">
            <form id="docinfo_form" is="iron-form">
                <h2>Máte nějaký dotaz? Zeptejte se nás.</h2>
                <gold-email-input id="email_input" error-message="Špatný formát"
                                  label="Vaše emailová adresa" required>
                </gold-email-input>
                <paper-textarea id="message_input" label="Vaše zpráva" char-counter
                                error-message="Zpráva nesmí být prázdná"
                                maxlength="2000" required></paper-textarea>
                <paper-button raised on-tap="send">Odeslat</paper-button>
            </form>
        </div>
    </template>

    <script>
        Polymer({
            is: 'docinfo-view',

            properties: {
                messageSent: {
                    type: Boolean,
                    value: false
                }
            },

            observers: [
                "routePathObserver(route)"
            ],

            routePathObserver: function (route) {
                var path = route.path;

                if (route.prefix === "/docinfo" && path.length > 1) {
                    firebase.apps[0].database().ref("/docInfoVisitors").push(path.substring(1));
                }
            },

            send: function () {
                //  paper-textarea was not detected by form validation, so I'm validating the inputs manually
                if (this.$.email_input.validate() && this.$.message_input.validate()) {
                    this.sendQuestion();
                }
            },

            sendQuestion: function () {

                var email = this.$.email_input.value,
                    message = this.$.message_input.value,
                    db = firebase.apps[0].database();

                db.ref('/docInfoQuestions/').push({
                    "email": email,
                    "message": message
                }).then(function () {
                    this.fire("show-toast", {text: "Zpráva odeslána"});
                    this.messageSent = true;
                }.bind(this), function () {
                    this.fire("show-dialog", {
                        path: "", viewName: "genericdialog", open: true,
                        data: {
                            text: 'Při ukládání dat se vyskytla chyba. Zkuste to prosím znovu.',
                            buttonText: 'Zavřít'
                        }
                    });
                }.bind(this));
            },

            computeUrl: function (signedIn) {
                return (signedIn) ? "/office/registration/first" : "/registration/doc";
            },

            computeButtonText: function (signedIn) {
                return (signedIn) ? "Přidat ordinaci" : "Zaregistrovat";
            }
        });
    </script>
</dom-module>
