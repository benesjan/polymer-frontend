<link rel="import" href="/bower_components/polymer/polymer.html">

<link rel="import" href="/custom_components/office-element.html">
<link rel="import" href="/bower_components/polymerfire/firebase-document.html">
<link rel="import" href="/bower_components/paper-spinner/paper-spinner-lite.html">

<dom-module id="d-view">
    <template>
        <style>
            div {
                display: flex;
                justify-content: center;
            }
        </style>

        <firebase-document id="office_document" app-name="doctor-appointment-system" path="/offices/{{profileID}}" data="{{officeData}}">
        </firebase-document>

        <div hidden="[[!dataNotLoaded]]">
            <paper-spinner-lite active="[[dataNotLoaded]]"></paper-spinner-lite>
        </div>

        <office-element hidden="[[dataNotLoaded]]" office-data="[[officeData]]"></office-element>
    </template>

    <script>
        Polymer({
            is: 'd-view',

            properties: {
                profileID: {
                    type: String,
                    computed: 'computeID(route.path)'
                },

                dataNotLoaded: {
                    type: Boolean,
                    computed: 'computeDataAvailability(officeData)',
                    observer: 'disableReference'
                }
            },

            listeners: {
                'handle-appointment': '_onHandleAppointment'
            },

            disableReference: function (dataNotLoaded) {
                if (!dataNotLoaded) {
                    this.$.office_document.ref.off();
                }
            },

            _onHandleAppointment: function (event) {
                var id = Number(event.detail['appointmentID']);
                console.log(id);
                event.stopPropagation ? event.stopPropagation() : (event.cancelBubble = true);
            },

            computeID: function (path) {
                if (path.length < 2) return null;
                return (path.substring(1));
            },

            computeDataAvailability: function (data) {
                return Object.keys(data).length === 0;
            }
        });
    </script>
</dom-module>
