<link rel="import" href="/bower_components/polymer/polymer.html">

<link rel="import" href="/bower_components/iron-meta/iron-meta.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/paper-input/paper-input.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/custom_components/custom-button.html">

<link rel="import" href="/behaviors/input-validation-behavior.html">
<link rel="import" href="/behaviors/pass-visibility-behavior.html">

<link rel="import" href="/styles/dialog-styles.html">


<dom-module id="passreset-view">
    <template>
        <style include="custom-button dialog-styles">
        </style>
        <iron-meta id="meta"></iron-meta>

        <p>Prosím zadejte nové heslo:</p>
        <paper-input id="passID" value="{{password}}" label="Nové heslo" required auto-validate
                     type="password"
                     minlength="6" maxlength="48" error-message="Moc krátké" on-input="checkIfValid">
            <paper-icon-button icon="[[eyeIcon]]" on-tap="passVisibilityChange" suffix></paper-icon-button>
        </paper-input>
        <custom-button responsive>
            <button id="confirm_button" type="button" dialog-confirm autofocus on-tap="resetPassword"
                    disabled>
                Změnit heslo
            </button>
        </custom-button>

        <paper-icon-button dialog-dismiss icon="close" id="closeBtn"></paper-icon-button>
    </template>

    <script>
        Polymer({
            is: 'passreset-view',

            behaviors: [InputValidationBehavior, PassVisibilityBehavior],

            validationIDs: ["passID"],

            resetPassword: function () {
                var auth = document.getElementById('appID').app.auth();
                auth.confirmPasswordReset(this.$.meta.byKey('actionCode'), this.password).then(function () {
                    this.fire("show-toast", {text: "Heslo změněno"});
                }.bind(this)).catch(function (error) {
                    console.log(error);
                })
            }
        });
    </script>
</dom-module>
