<link rel="import" href="/bower_components/polymer/polymer.html">

<link rel="import" href="/custom_components/time-prototype.html">

<dom-module id="calendar-element">
    <template>
        <style>
            :host {
                text-align: left;
                background-color: gray;
            }

            .wrapper {
                display: flex;
                flex: 0;
                /*background-color: gray;*/
            }

            .wrapper > div:not(:first-child) {
                margin-left: 3%;
            }

            .column {
                /*display: flex;*/
                /*float: left;*/
            }

            button {
                background-color: var(--app-accent-color);
                border: none;
                color: white;
                /*padding: 10% 1%;*/
                text-align: center;
                text-decoration: none;
                /*display: inline-block;*/
                font-size: 16px;
                /*width: 100%;*/
                cursor: pointer;
            }
        </style>
        <h3>Kalendář</h3>
        <div class="wrapper">
            <template is="dom-repeat" items="[[officeHours]]" as="hours">
                <div class="column">
                    Day:
                    <template is="dom-repeat" items="{{computeBookTimes(hours, visitLength)}}" as="entry">
                        <button>[[entry]]</button>
                    </template>
                </div>
            </template>
        </div>

    </template>

    <script>
        Polymer({
            is: 'calendar-element',

            properties: {
                officeHours: {
                    type: Object
                },

                visitLength: {
                    type: Number
                }
            },

            computeBookTimes: function (officeHours, visitLength) {
                var bookTimes = [];
                visitLength = Number(visitLength);
                if (officeHours.available) {
                    var intervals = this.computeIntervals(officeHours.hours);
                    for (var i = 0; i < intervals.length; i++) {
                        var interval = intervals[i];
                        var currentTime = interval.from;
                        var nextTime;
                        while (currentTime.isValidBookTime(interval, nextTime = generateIncrementedTime(currentTime, visitLength))) {
                            bookTimes.push(currentTime.toString());
                            currentTime = nextTime;
                        }
                    }
                }
                return bookTimes;
            },

            computeIntervals: function (hours) {
                var splittedHours = hours.split(',');
                var intervals = [];
                for (var i = 0; i < splittedHours.length; i++) {
                    var timeVals = splittedHours[i].split('-');
                    intervals.push({"from": CustomTimeBuilder(timeVals[0]), "to": CustomTimeBuilder(timeVals[1])});
                }
                return intervals;
            }
        });
    </script>
</dom-module>
